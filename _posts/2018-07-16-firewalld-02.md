---
layout: post
title: "Firewalld 2"
date: 2018-07-16 15:48:08
image: '/assets/img/'
description: 'Firewalld 的基础概念'
main-class: 'tools'
color: 
tags: 
  - tools
  - firewalld
categories:
  - tools
twitter_text: 'Concepts of Firewalld'
introduction: 'Concepts of Firewalld'
---

# 前言

**[Firewalld][firewalld]** 是一个本地的网络策略管理软件，与 iptables 启相同的作用

>Firewalld provides a dynamically managed firewall with support for network/firewall zones that define the trust level of network connections or interfaces. It has support for IPv4, IPv6 firewall settings, ethernet bridges and IP sets. There is a separation of runtime and permanent configuration options. It also provides an interface for services or applications to add firewall rules directly

从 **RHEL7/Centos7** 开始，系统默认的防火墙软件从 iptables 替换成了 firewalld

这的确是一个不小的变化，从而让很多以前熟悉 iptables 的运维小伙伴一下子变得无所适从

相对于 iptables, firewalld 的确有一些更先进的管理理念，不过也在挑战传统的运维体验

这里就 firewalld 的基础概念进行一个讲解和介绍

参考 **[A service daemon with D-Bus interface][firewalld]** 和 **[USING FIREWALLS][firewalls]**

**[Documentation][firewalld_doc]**

> **Tip:** 当前最新的版本为 **firewalld 0.6.0 release**


---

# 基础

## 软件架构

![firewalld](/assets/img/firewalld/firewalld02.png)

**firewall-cmd/firewall-config/firewall-applet/firewall-offline-cmd** 用于对 firewalld 的网络规则进行配置

>**firewall-cmd/firewall-config/firewall-applet** 通过 **D-bus** 来对 firewalld 进行配置(可以同时实现 runtime 和 permanent 的配置)


>**firewall-offline-cmd** 直接修改 firewalld 配置文件，然后应用配置文件，来实现间接的控制


## 两层结构

firewalld 分成两层结构

* D-Bus
* Core

### D-Bus

D-Bus 提供一个抽象的接口层，用于与外层的客户端软件进行通讯，并且修改 firewalld 行为

### Core

Core 又可以分为两层

* 模型的实例层
* 后端支持层

模型的实例层用于管理配置文件，和根据配置文件来初始化模型实例，用于将 DSL 与 网络规则进行互化

后端支持层的职能是调用基础工具来实现模型所表达的网络规则，也可以理解为调用基础工具或者基础网络库来与内核中的模块通讯，以支持和实现 DSL 所表达的网络策略

这是应用层到内核层的边界

>**Note:** firewalld 并不是强依赖 NetworkManager,但是还是建议使用 NetworkManager,因为任何网络变更都会被 NetworkManger 及时通知到 firewalld，这样 firewalld 就可实时了解到真实的网络环境，如果不使用 NetworkManager 也不影响 firewalld 的已有配置与规则，但是如果网络发生了临时性的变更，那么 firewalld 并不会自动有感知的，于是之前的配置很可能就会不符合当前的新的网络环境，于是产生一些意想不到的网络表现(由于规则与实情不匹配导致的)

## 模型的实例层

### zone

### service

### ipset

### helper

### icmptype

### policy

### direct



---

# 总结

firewalld 是一个更为先进的 firewall 配置软件

对于防火墙的管理有一套更为强大和灵活的管理方法　

正确理解概念是轻松掌握领域知识的捷径

后面再讲讲 firewalld 的一些实例

* TOC
{:toc}

---

[firewalld]:https://firewalld.org/
[firewalls]:https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-using_firewalls
[firewalld_doc]:https://firewalld.org/documentation/
